<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>vitra</title><meta name="description" content="Documentation for vitra"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">vitra</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>vitra</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#vitra" id="vitra" style="color: inherit; text-decoration: none;">
  <h1>Vitra</h1>
</a>
<p><strong>⚠️Vitra is a work in progress and is currently a proof-of-concept. Do not use it in production.⚠️</strong></p>
<p>A framework for cooperatively-owned databases using smart contracts. <a href="https://github.com/pfrazee/vitra/blob/master/docs/whitepaper.md">Read the white paper</a>.</p>
<p>Vitra could be described as a hybrid of blockchains and traditional databases. It takes inspiration from <a href="https://certificate.transparency.dev/">Certificate Transparency</a> and <a href="https://ethereum.org/en/developers/docs/scaling/layer-2-rollups/">Layer 2 Optimistic Rollups</a> to create a hosted smart-contract protocol called <a href="https://github.com/pfrazee/vitra/blob/master/docs/whitepaper.md">&quot;Execution Transparency (ET).&quot;</a> Vitra databases use <a href="https://transparency.dev/verifiable-data-structures">verifiable logs</a> to record all transactions in a publicly-auditable structure. A contract written in Javascript then enforces the schemas and business logic of the database. By replaying the logs, users can audit the execution of the database and ensure that each participant is playing by the rules. Vitra also responds to every transaction with an inclusion proof, giving end-users an efficient solution to proving their data in the database.</p>
<p>Vitra&#39;s goal is to enable multiple orgs to share ownership and operation of a database. A federated network could use Vitra to share user registries, data schemas, or data indexes. Vitra ensures that each org follows the contract of the database, enabling resource limits, multi-party votes, ownership policies, and more.</p>
<p>Vitra uses the <a href="https://hypercore-protocol.org">Hypercore Protocol</a> to implement its verifiable logs.</p>
<p><em>&quot;Vitra&quot; is latin for &quot;Glass.&quot;</em></p>

<a href="#todo" id="todo" style="color: inherit; text-decoration: none;">
  <h2>TODO</h2>
</a>
<ul>
<li><input disabled="" type="checkbox"> API details &amp; various tasks<ul>
<li><input disabled="" type="checkbox"> Flows for creating oplogs</li>
<li><input disabled="" type="checkbox"> Networking</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Implement developer APIs<ul>
<li><input disabled="" type="checkbox"> Debugging information for contract-definition issues</li>
<li><input disabled="" type="checkbox"> Testing sandbox for debugging changes to an active</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Edge-case protocols<ul>
<li><input disabled="" type="checkbox"> Source-code rollback protocol for handling bad deployments</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Documentation<ul>
<li><input disabled="" type="checkbox"> Overview</li>
<li><input disabled="" type="checkbox"> Basic usage</li>
<li><input disabled="" type="checkbox"> Examples</li>
<li><input disabled="" type="checkbox"> Technical description</li>
<li><input disabled="" type="checkbox"> Complete the white paper</li>
</ul>
</li>
<li><input disabled="" type="checkbox"> Create CLI</li>
</ul>

<a href="#done" id="done" style="color: inherit; text-decoration: none;">
  <h2>DONE</h2>
</a>
<ul>
<li><input checked="" disabled="" type="checkbox"> Implement initialization</li>
<li><input checked="" disabled="" type="checkbox"> Implement transactions<ul>
<li><input checked="" disabled="" type="checkbox"> API calls</li>
<li><input checked="" disabled="" type="checkbox"> Op execution</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> Implement verification<ul>
<li><input checked="" disabled="" type="checkbox"> Append-only constraint violation detection</li>
<li><input checked="" disabled="" type="checkbox"> Log replay</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> Implement compact (shareable) proof generation<ul>
<li><input checked="" disabled="" type="checkbox"> Operation inclusion proofs</li>
<li><input checked="" disabled="" type="checkbox"> Fraud proofs<ul>
<li><input checked="" disabled="" type="checkbox"> Append-only violations</li>
<li><input checked="" disabled="" type="checkbox"> Contract violations</li>
</ul>
</li>
</ul>
</li>
<li><input checked="" disabled="" type="checkbox"> Implement monitoring</li>
<li><input checked="" disabled="" type="checkbox"> Additional tests<ul>
<li><input checked="" disabled="" type="checkbox"> Participant changes</li>
<li><input checked="" disabled="" type="checkbox"> Contract changes</li>
</ul>
</li>
</ul>

<a href="#example-usage" id="example-usage" style="color: inherit; text-decoration: none;">
  <h2>Example usage</h2>
</a>
<p>The following contract creates a shared key/value database. Multiple orgs may participate in operating the database, but one participant is designated the &quot;admin&quot; and given control over the other participants.</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> </span><span class="hl-2">assert</span><span class="hl-1"> </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;assert&#39;</span><br/><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">index</span><span class="hl-1">, </span><span class="hl-2">isWriter</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;contract&#39;</span><br/><br/><span class="hl-4">// database api</span><br/><span class="hl-4">// =</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">get</span><span class="hl-1"> ({</span><span class="hl-2">key</span><span class="hl-1">}) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">key</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">key</span><span class="hl-1">.</span><span class="hl-6">startsWith</span><span class="hl-1">(</span><span class="hl-3">&#39;/&#39;</span><span class="hl-1">)) </span><span class="hl-2">key</span><span class="hl-1"> = </span><span class="hl-3">`/</span><span class="hl-5">${</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">index</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">`/values</span><span class="hl-5">${</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">list</span><span class="hl-1"> ({</span><span class="hl-2">prefix</span><span class="hl-1">}) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">prefix</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">prefix</span><span class="hl-1">.</span><span class="hl-6">startsWith</span><span class="hl-1">(</span><span class="hl-3">&#39;/&#39;</span><span class="hl-1">)) </span><span class="hl-2">prefix</span><span class="hl-1"> = </span><span class="hl-3">`/</span><span class="hl-5">${</span><span class="hl-2">prefix</span><span class="hl-5">}</span><span class="hl-3">`</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">index</span><span class="hl-1">.</span><span class="hl-6">list</span><span class="hl-1">(</span><span class="hl-3">`/values</span><span class="hl-5">${</span><span class="hl-2">prefix</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">put</span><span class="hl-1"> ({</span><span class="hl-2">key</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">}, </span><span class="hl-2">emit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">isWriter</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">key</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">value</span><span class="hl-1"> !== </span><span class="hl-3">&#39;undefined&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">emit</span><span class="hl-1">({</span><span class="hl-2">op:</span><span class="hl-1"> </span><span class="hl-3">&#39;PUT&#39;</span><span class="hl-1">, </span><span class="hl-2">key</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">})</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">del</span><span class="hl-1"> ({</span><span class="hl-2">key</span><span class="hl-1">}, </span><span class="hl-2">emit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">isWriter</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">key</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">emit</span><span class="hl-1">({</span><span class="hl-2">op:</span><span class="hl-1"> </span><span class="hl-3">&#39;DEL&#39;</span><span class="hl-1">, </span><span class="hl-2">key</span><span class="hl-1">, </span><span class="hl-2">value</span><span class="hl-1">})</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">getAdmin</span><span class="hl-1"> () {</span><br/><span class="hl-1">  </span><span class="hl-0">return</span><span class="hl-1"> </span><span class="hl-2">index</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/admin&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">setAdmin</span><span class="hl-1"> ({</span><span class="hl-2">pubkey</span><span class="hl-1">}, </span><span class="hl-2">emit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">isWriter</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">emit</span><span class="hl-1">({</span><span class="hl-2">op:</span><span class="hl-1"> </span><span class="hl-3">&#39;SET_ADMIN&#39;</span><span class="hl-1">, </span><span class="hl-2">pubkey</span><span class="hl-1">})</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">addParticipant</span><span class="hl-1"> ({</span><span class="hl-2">pubkey</span><span class="hl-1">}, </span><span class="hl-2">emit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">isWriter</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">emit</span><span class="hl-1">({</span><span class="hl-2">op:</span><span class="hl-1"> </span><span class="hl-3">&#39;ADD_PARTICIPANT&#39;</span><span class="hl-1">, </span><span class="hl-2">pubkey</span><span class="hl-1">})</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-6">removeParticipant</span><span class="hl-1"> ({</span><span class="hl-2">pubkey</span><span class="hl-1">}, </span><span class="hl-2">emit</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">isWriter</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">  </span><span class="hl-6">emit</span><span class="hl-1">({</span><span class="hl-2">op:</span><span class="hl-1"> </span><span class="hl-3">&#39;REMOVE_PARTICIPANT&#39;</span><span class="hl-1">, </span><span class="hl-2">pubkey</span><span class="hl-1">})</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-4">// transaction handler</span><br/><span class="hl-4">// =</span><br/><br/><span class="hl-0">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">apply</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-6">PUT</span><span class="hl-1"> (</span><span class="hl-2">tx</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1"> !== </span><span class="hl-3">&#39;undefined&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1">.</span><span class="hl-6">startsWith</span><span class="hl-1">(</span><span class="hl-3">&#39;/&#39;</span><span class="hl-1">)) </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1"> = </span><span class="hl-3">`/</span><span class="hl-5">${</span><span class="hl-2">op</span><span class="hl-9">.</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><br/><span class="hl-1">    </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">put</span><span class="hl-1">(</span><span class="hl-3">`/values</span><span class="hl-5">${</span><span class="hl-2">op</span><span class="hl-9">.</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">value</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">DEL</span><span class="hl-1"> (</span><span class="hl-2">tx</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-0">if</span><span class="hl-1"> (!</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1">.</span><span class="hl-6">startsWith</span><span class="hl-1">(</span><span class="hl-3">&#39;/&#39;</span><span class="hl-1">)) </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">key</span><span class="hl-1"> = </span><span class="hl-3">`/</span><span class="hl-5">${</span><span class="hl-2">op</span><span class="hl-9">.</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><br/><span class="hl-1">    </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">delete</span><span class="hl-1">(</span><span class="hl-3">`/values</span><span class="hl-5">${</span><span class="hl-2">op</span><span class="hl-9">.</span><span class="hl-2">key</span><span class="hl-5">}</span><span class="hl-3">`</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">SET_ADMIN</span><span class="hl-1"> (</span><span class="hl-2">tx</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">adminEntry</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">state</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/admin&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(!</span><span class="hl-2">adminEntry</span><span class="hl-1"> || </span><span class="hl-2">adminEntry</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-2">ack</span><span class="hl-1">.</span><span class="hl-2">origin</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">put</span><span class="hl-1">(</span><span class="hl-3">&#39;/admin&#39;</span><span class="hl-1">, {</span><span class="hl-2">pubkey:</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">})</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">ADD_PARTICIPANT</span><span class="hl-1"> (</span><span class="hl-2">tx</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">adminEntry</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">state</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/admin&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">adminEntry</span><span class="hl-1">?.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-2">ack</span><span class="hl-1">.</span><span class="hl-2">origin</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">addOplog</span><span class="hl-1">(</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">)</span><br/><span class="hl-1">  },</span><br/><br/><span class="hl-1">  </span><span class="hl-6">REMOVE_PARTICIPANT</span><span class="hl-1"> (</span><span class="hl-2">tx</span><span class="hl-1">, </span><span class="hl-2">op</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-5">typeof</span><span class="hl-1"> </span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-3">&#39;string&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-2">length</span><span class="hl-1"> === </span><span class="hl-7">64</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">adminEntry</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">state</span><span class="hl-1">.</span><span class="hl-6">get</span><span class="hl-1">(</span><span class="hl-3">&#39;/admin&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-6">assert</span><span class="hl-1">(</span><span class="hl-2">adminEntry</span><span class="hl-1">?.</span><span class="hl-2">pubkey</span><span class="hl-1"> === </span><span class="hl-2">ack</span><span class="hl-1">.</span><span class="hl-2">origin</span><span class="hl-1">)</span><br/><span class="hl-1">    </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">removeOplog</span><span class="hl-1">(</span><span class="hl-2">op</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">)</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code></pre>
<p>This contract is then instantiated as a new database using the Vitra API:</p>
<pre><code class="language-js"><span class="hl-0">import</span><span class="hl-1"> { </span><span class="hl-2">Database</span><span class="hl-1"> } </span><span class="hl-0">from</span><span class="hl-1"> </span><span class="hl-3">&#39;vitra&#39;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">db</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">Database</span><span class="hl-1">.</span><span class="hl-6">create</span><span class="hl-1">(</span><span class="hl-3">&#39;./db-storage-path&#39;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-2">contract:</span><span class="hl-1"> {</span><span class="hl-2">source:</span><span class="hl-1"> </span><span class="hl-8">MY_CONTRACT</span><span class="hl-1">}</span><br/><span class="hl-1">})</span><br/><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-6">swarm</span><span class="hl-1">() </span><span class="hl-4">// share on the hypercore network</span><br/><span class="hl-2">console</span><span class="hl-1">.</span><span class="hl-6">log</span><span class="hl-1">(</span><span class="hl-3">&#39;New database created, public key:&#39;</span><span class="hl-1">, </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">(</span><span class="hl-3">&#39;hex&#39;</span><span class="hl-1">))</span><br/><br/><span class="hl-4">// set myself as the admin</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-6">call</span><span class="hl-1">(</span><span class="hl-3">&#39;setAdmin&#39;</span><span class="hl-1">, {</span><span class="hl-2">pubkey:</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-2">myOplog</span><span class="hl-1">.</span><span class="hl-2">pubkey</span><span class="hl-1">.</span><span class="hl-6">toString</span><span class="hl-1">(</span><span class="hl-3">&#39;hex&#39;</span><span class="hl-1">)})</span><br/><br/><span class="hl-4">// set a value</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">tx</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-6">call</span><span class="hl-1">(</span><span class="hl-3">&#39;put&#39;</span><span class="hl-1">, {</span><span class="hl-2">key:</span><span class="hl-1"> </span><span class="hl-3">&#39;hello&#39;</span><span class="hl-1">, </span><span class="hl-2">value:</span><span class="hl-1"> </span><span class="hl-3">&#39;world&#39;</span><span class="hl-1">})</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">verifyInclusion</span><span class="hl-1">() </span><span class="hl-4">// validate the proofs for this transaction</span><br/><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-6">whenProcessed</span><span class="hl-1">() </span><span class="hl-4">// wait for the transaction to process</span><br/><br/><span class="hl-4">// get a value</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-8">tx2</span><span class="hl-1"> = </span><span class="hl-0">await</span><span class="hl-1"> </span><span class="hl-2">db</span><span class="hl-1">.</span><span class="hl-6">call</span><span class="hl-1">(</span><span class="hl-3">&#39;get&#39;</span><span class="hl-1">, {</span><span class="hl-2">key:</span><span class="hl-1"> </span><span class="hl-3">&#39;hello&#39;</span><span class="hl-1">})</span><br/><span class="hl-2">tx</span><span class="hl-1">.</span><span class="hl-2">response</span><span class="hl-1"> </span><span class="hl-4">// =&gt; &#39;world&#39;</span>
</code></pre>

<a href="#future-improvements" id="future-improvements" style="color: inherit; text-decoration: none;">
  <h2>Future improvements</h2>
</a>

<a href="#transaction-result-inclusion-proofs" id="transaction-result-inclusion-proofs" style="color: inherit; text-decoration: none;">
  <h3>Transaction-result inclusion proofs</h3>
</a>
<p>Calls to a contract (transactions) may produce one or more operations, and each operation may produce one or more changes (results). Operations are published by the contract participants by writing to their &quot;oplogs,&quot; while the operation results are always published by the executor in the &quot;index log.&quot; Using Hypercore, we&#39;re able to generate inclusion proofs for any log message. </p>
<p>Inclusion proofs are comprised of a log message&#39;s sequence number, the root hash of the log&#39;s merkle tree, and a signature over the root hash by the log&#39;s keypair. We can use the inclusion proof to independently verify that a log message was published by a log, and to prove mischief if the log owner ever attempts to unpublish a message.</p>
<p>Vitra can easily generate an inclusion proof for <em>operations</em> when handling a transaction because there&#39;s a local interactive session with the participant that&#39;s executing the transaction. For the <em>results</em> published to the index log, there&#39;s no guarantee of an interactive session as the participant may not be the executor. The Hypercore protocol has mechanisms for requesting log inclusion proofs over a connection (this is fundamental to the protocol) but the implementation embeds this in the replication logic and does not currently include APIs to fetch proofs for random messages in a log. By adding those APIs to Hypercore, we can add transaction-result inclusion proofs to Vitra&#39;s API.</p>

<a href="#additional-append-only-fraud-proof-detection" id="additional-append-only-fraud-proof-detection" style="color: inherit; text-decoration: none;">
  <h3>Additional append-only fraud proof detection</h3>
</a>
<p>Violations to the append-only constraint are currently detected when verifying an inclusion proof. It is possible to detect append-only violations more aggressively by checking for them during replication. (In this framework, forking explicitly with Hypercore&#39;s truncate() API and forking implicitly with split logs are both considered violations.)</p>

<a href="#native-code-contract-runtime" id="native-code-contract-runtime" style="color: inherit; text-decoration: none;">
  <h3>Native-code contract runtime</h3>
</a>
<p>Currenly Vitra is using [<a href="https://github.com/laverdet/isolated-vm%5D">https://github.com/laverdet/isolated-vm]</a> to execute contracts (via the <a href="https://github.com/confine-sandbox">Confine Sandbox</a> framework). This could be optimized by replacing the Confine guest process with a C++ program that embeds V8, which would reduce the amount of marshalling between V8 contexts.</p>

<a href="#zk-snarks" id="zk-snarks" style="color: inherit; text-decoration: none;">
  <h3>ZK-SNARKs</h3>
</a>
<p>Vitra uses transaction logs and log-replays to audit execution of a database. Novel research in Layer 2 rollups has recently focused on using zero-knowledge proofs to create a more compact and efficient approach to auditing (ZK-Rollups). It should be possible to apply the same research to Vitra.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/TestContractExecutorBehavior.html" class="tsd-kind-icon">Test<wbr/>Contract<wbr/>Executor<wbr/>Behavior</a></li><li class="tsd-kind-class"><a href="classes/BlockInclusionProof.html" class="tsd-kind-icon">Block<wbr/>Inclusion<wbr/>Proof</a></li><li class="tsd-kind-class"><a href="classes/BlockRewriteFraudProof.html" class="tsd-kind-icon">Block<wbr/>Rewrite<wbr/>Fraud<wbr/>Proof</a></li><li class="tsd-kind-class"><a href="classes/CannotFetchOpError.html" class="tsd-kind-icon">Cannot<wbr/>Fetch<wbr/>Op<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ChangeMismatchError.html" class="tsd-kind-icon">Change<wbr/>Mismatch<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ChangeNotProducedByExecutorError.html" class="tsd-kind-icon">Change<wbr/>Not<wbr/>Produced<wbr/>By<wbr/>Executor<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ChangeNotProducedByMonitorError.html" class="tsd-kind-icon">Change<wbr/>Not<wbr/>Produced<wbr/>By<wbr/>Monitor<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ContractExecutor.html" class="tsd-kind-icon">Contract<wbr/>Executor</a></li><li class="tsd-kind-class"><a href="classes/ContractFraudProof.html" class="tsd-kind-icon">Contract<wbr/>Fraud<wbr/>Proof</a></li><li class="tsd-kind-class"><a href="classes/ContractFraudProofDetails.html" class="tsd-kind-icon">Contract<wbr/>Fraud<wbr/>Proof<wbr/>Details</a></li><li class="tsd-kind-class"><a href="classes/ContractMonitor.html" class="tsd-kind-icon">Contract<wbr/>Monitor</a></li><li class="tsd-kind-class"><a href="classes/Database.html" class="tsd-kind-icon">Database</a></li><li class="tsd-kind-class"><a href="classes/FraudProof.html" class="tsd-kind-icon">Fraud<wbr/>Proof</a></li><li class="tsd-kind-class"><a href="classes/IndexLog.html" class="tsd-kind-icon">Index<wbr/>Log</a></li><li class="tsd-kind-class"><a href="classes/InvalidSchemaError.html" class="tsd-kind-icon">Invalid<wbr/>Schema<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/Log.html" class="tsd-kind-icon">Log</a></li><li class="tsd-kind-class"><a href="classes/LogForkFraudProof.html" class="tsd-kind-icon">Log<wbr/>Fork<wbr/>Fraud<wbr/>Proof</a></li><li class="tsd-kind-class"><a href="classes/MonitorApplyFailedError.html" class="tsd-kind-icon">Monitor<wbr/>Apply<wbr/>Failed<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/NoGenesisInputsDeclaredError.html" class="tsd-kind-icon">No<wbr/>Genesis<wbr/>Inputs<wbr/>Declared<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/NonParticipantError.html" class="tsd-kind-icon">Non<wbr/>Participant<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/OpLog.html" class="tsd-kind-icon">Op<wbr/>Log</a></li><li class="tsd-kind-class"><a href="classes/Operation.html" class="tsd-kind-icon">Operation</a></li><li class="tsd-kind-class"><a href="classes/ProcessedOutOfOrderError.html" class="tsd-kind-icon">Processed<wbr/>Out<wbr/>Of<wbr/>Order<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ReadStream.html" class="tsd-kind-icon">Read<wbr/>Stream</a></li><li class="tsd-kind-class"><a href="classes/Storage.html" class="tsd-kind-icon">Storage</a></li><li class="tsd-kind-class"><a href="classes/StorageInMemory.html" class="tsd-kind-icon">Storage<wbr/>In<wbr/>Memory</a></li><li class="tsd-kind-class"><a href="classes/Transaction.html" class="tsd-kind-icon">Transaction</a></li><li class="tsd-kind-class"><a href="classes/UnexpectedPathError.html" class="tsd-kind-icon">Unexpected<wbr/>Path<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/UnexpectedSeqError.html" class="tsd-kind-icon">Unexpected<wbr/>Seq<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/VM.html" class="tsd-kind-icon">VM</a></li><li class="tsd-kind-class"><a href="classes/VerificationError.html" class="tsd-kind-icon">Verification<wbr/>Error</a></li><li class="tsd-kind-interface"><a href="interfaces/BaseApiCallRes.html" class="tsd-kind-icon">Base<wbr/>Api<wbr/>Call<wbr/>Res</a></li><li class="tsd-kind-interface"><a href="interfaces/ContractCode.html" class="tsd-kind-icon">Contract<wbr/>Code</a></li><li class="tsd-kind-interface"><a href="interfaces/DatabaseCreateOpts.html" class="tsd-kind-icon">Database<wbr/>Create<wbr/>Opts</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexBatchEntry.html" class="tsd-kind-icon">Index<wbr/>Batch<wbr/>Entry</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexChange.html" class="tsd-kind-icon">Index<wbr/>Change</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexHistoryEntry.html" class="tsd-kind-icon">Index<wbr/>History<wbr/>Entry</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexHistoryOpts.html" class="tsd-kind-icon">Index<wbr/>History<wbr/>Opts</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexLogEntry.html" class="tsd-kind-icon">Index<wbr/>Log<wbr/>Entry</a></li><li class="tsd-kind-interface"><a href="interfaces/IndexLogListOpts.html" class="tsd-kind-icon">Index<wbr/>Log<wbr/>List<wbr/>Opts</a></li><li class="tsd-kind-interface"><a href="interfaces/OpLogEntry.html" class="tsd-kind-icon">Op<wbr/>Log<wbr/>Entry</a></li><li class="tsd-kind-interface"><a href="interfaces/OperationResults.html" class="tsd-kind-icon">Operation<wbr/>Results</a></li><li class="tsd-kind-interface"><a href="interfaces/VerifyInclusionProofOpts.html" class="tsd-kind-icon">Verify<wbr/>Inclusion<wbr/>Proof<wbr/>Opts</a></li><li class="tsd-kind-type-alias"><a href="modules.html#ApplyActions" class="tsd-kind-icon">Apply<wbr/>Actions</a></li><li class="tsd-kind-type-alias"><a href="modules.html#Key" class="tsd-kind-icon">Key</a></li><li class="tsd-kind-function"><a href="modules.html#keyToBuf" class="tsd-kind-icon">key<wbr/>To<wbr/>Buf</a></li><li class="tsd-kind-function"><a href="modules.html#keyToStr" class="tsd-kind-icon">key<wbr/>To<wbr/>Str</a></li><li class="tsd-kind-function"><a href="modules.html#verifyInclusionProof" class="tsd-kind-icon">verify<wbr/>Inclusion<wbr/>Proof</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-private"><span class="tsd-kind-icon">Private method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>